title=MoteurCsv le JPA du CSV
date=2012-02-20
type=post
tags=CSV,Java
status=published
id=moteurcsv-le-jpa-du-csv
~~~~~~
Voici un titre qui va faire gonfler mes chevilles :)<br />Je vais donc vous présenter une petite librairie Java sans prétention que j'ai réalisé afin de pourvoir lire et écrire des fichiers CSV facilement.<br /><br /><h1>C'est quoi le CSV?</h1>Bon pour la définition du format CSV, je vous invite à consulter l'article <a href="http://fr.wikipedia.org/wiki/Comma-separated_values">wikipedia</a>.<br /><br /><h1>Pourquoi cette librairie?</h1>Cette librairie a été crée afin de pouvoir gérer le format <a href="https://developers.google.com/transit/gtfs/reference">GTFS</a>. Ce format est utilisé afin de décrire un réseau de Transports en commun. Techniquement, c'est un zip contenant des fichiers CSV.<br />J'ai eu à utiliser ce format suite à l'ouverture des données de transports à Rennes où j'ai réalisé une application Android (Transports Rennes) permettant de consulter les horaires de bus.<br />A l'époque où j'ai créé cette librairie, je baignais dans du JPA la journée, et j'avoue que j'aime beaucoup l'idée de décrire du mapping directement dans la classe associé en utilisant des annotations.<br />C'est comme ça que MoteurCsv est né.<br /><br /><h1>Alors comment ça s'utilise?</h1>J'ai essayé de simplifier au maximun l'utilisation de la librairie.<br /><br /><h2>Installation</h2><h3>Maven</h3>Si vous êtes sous maven, l'intégration dans votre projet est très simple.<br />Il suffit d'ajouter dans votre pom.xml :<br /><pre class="brush: xml">&lt;dependencies&gt;<br />    &lt;dependency&gt;<br />        &lt;groupId&gt;fr.ybo&lt;/groupId&gt;<br />        &lt;artifactId&gt;moteurcsv&lt;/artifactId&gt;<br />    &lt;/dependency&gt;<br />&lt;/dependencies&gt;<br /><br />&lt;repositories&gt;<br />    &lt;repository&gt;<br />        &lt;id&gt;ybonnel-release&lt;/id&gt;<br />        &lt;url&gt;https://repository-ybonnel.forge.cloudbees.com/release/&lt;/url&gt;<br />    &lt;/repository&gt;<br />&lt;/repositories&gt;<br /></pre><br /><h3>Autre</h3>Si vous n'êtes pas sous maven, il vous suffit d'intégrer les deux jars suivant :<br /><ul><li><a href="https://github.com/ybonnel/MoteurCsv/downloads">moteurcsv-X.Y.Z.jar</a></li><li><a href="http://sourceforge.net/projects/opencsv/">opencsv-2.3.jar</a></li></ul><br /><h2>Utilisation</h2>Maintenant le vif du sujet, comment utiliser cette petite librairie.<br />Afin de pouvoir lire ou écrire un CSV il faut commencer par décrire la classe correspondante.<br />On va prendre pour l'exemple un CSV décrivant des personnes avec deux colonnes : "nom" et "prenom".<br />Voici un exemple correspondant :<br /><pre class="brush: css">nom,prenom<br />Bonnel,Yan<br />Vador,Dark<br />Noël,Père<br /></pre><br /><h3>Déclaration de la classe</h3>Nous allons donc créer la classe Personne associée avec les annotations permettant de faire le mapping :<br /><br /><pre class="brush: java">// Annotation permettant de dire au moteur que cette classe est associée à un fichier CSV.<br />@FichierCsv<br />public class Personne {<br /><br />    // Annotation permettant de dire au moteur que cet attribut est mappé avec la colonne "nom" du CSV.<br />    @BaliseCsv("nom")<br />    private String nom;<br /><br />    // Annotation permettant de dire au moteur que cet attribut est mappé avec la colonne "prenom" du CSV.<br />    @BaliseCsv("prenom")<br />    private String prenom;<br />}<br /></pre><br /><h3>Création du moteur</h3><pre class="brush: java">MoteurCsv moteur = new MoteurCsv(Personne.class);<br /></pre><br /><h3>Lecture d'un fichier CSV</h3>Voici maintenant le code permettant de lire le fichier, et de le transformer en une liste d'objets :<br /><pre class="brush: java">InputStream stream = new FileInputStream(new File("personnes.csv"));<br />List&lt;Personne&gt; personnes = moteur.parseInputStream(stream, Personne.class);<br /></pre><br /><h3>Écriture d'un fichier CSV</h3>Et le core permettant d'écrire un fichier :<br /><pre class="brush: java">Writer writer = new FileWriter(new File("personnes.csv"));<br />moteur.writeFile(writer, personnes, Personne.class);<br /></pre><br /><h1>Conclusion</h1>J'espère que cette petite librairie sera utile à quelqu'un d'autre que moi :)<br />Elle est open-source (LGPL v3) : <a href="https://github.com/ybonnel/MoteurCsv">github.com/ybonnel/MoteurCsv</a><br />N'hésitez donc pas à forker et à faire des pull request!<br />Site généré contenant entre autre la javadoc : <a href="http://ybonnel.github.com/MoteurCsv">ybonnel.github.com/MoteurCsv</a>
